#
# Linux NVRAM Makefile
#
# Copyright 2013, ASUSTek Inc.
# All Rights Reserved.
# 
# THIS SOFTWARE IS OFFERED "AS IS", AND BROADCOM GRANTS NO WARRANTIES OF ANY
# KIND, EXPRESS OR IMPLIED, BY STATUTE, COMMUNICATION OR OTHERWISE. BROADCOM
# SPECIFICALLY DISCLAIMS ANY IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS
# FOR A SPECIFIC PURPOSE OR NONINFRINGEMENT CONCERNING THIS SOFTWARE.
#

SHDIR = $(ROOTDIR)/user/shared
OLD_PRODUCT_NAME = $(subst -,,$(CONFIG_PRODUCT))
ifeq ($(filter y, $(CONFIG_DEFAULTS_ASUS_RPN14) $(CONFIG_DEFAULTS_ASUS_RPN53)),y)
PH_NAME = $(shell expr substr $(OLD_PRODUCT_NAME) 1 4)
else
PH_NAME = $(CONFIG_PRODUCT)
endif

CFLAGS += -s -Wall \
	-DASUS_NVRAM \
	-DENCRYPT_CFG \
	-DPROFILE_HEADER=\"$(PH_NAME)\"

CFLAGS += -I$(ROOTDIR)/$(LINUXDIR)/include \
	-I$(SHDIR)/include

LDFLAGS	+= -L$(SHDIR) -lshared

TARGETS = nvram

OBJS = nvram.o

all: $(TARGETS)

$(TARGETS): $(OBJS)
	$(CC) -o $@ $(OBJS) $(LDFLAGS)
	$(STRIP) $@

clean:
	rm -f $(TARGETS) *.o

romfs:
	$(ROMFSINST) /usr/sbin/nvram
